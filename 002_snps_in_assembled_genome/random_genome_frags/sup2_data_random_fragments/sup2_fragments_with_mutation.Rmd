---
output:
  html_document:
    fig_caption: yes
    theme: spacelab
    toc: no
---
# **fragments carrying causative sup2 mutation from random iterations of arabidopsis genome**

Load libraries and the data
```{r setup, include=FALSE}
# load the required libraries and functions
library(knitr)
library(markdown)
#opts_chunk$set(dev = 'pdf')
library(reshape2)
library(MESS)
library(tcltk2)

# source custom R functions
source('~/git-hub-repos/shyamrallapalli/mutations_hts_noref/lib/ggplot_theme.R')
source('~/git-hub-repos/shyamrallapalli/mutations_hts_noref/lib/zero_ratio_adj.R')

```

...     
Arabdiopsis genome is fragmented using a log-normal distribution with parameters derived from an assembly made using Allen et al miR159 sequence data.

867 iterations of fragments were generated and parent filtered sup2 mutant variant information is used to assign variants to made genome fragments

Data for the fragment carrying sup2 mutation from all iterations is extracted

...  		

...

##### read file with fragment ids of causatiave mutation for all iterations
##### store the data in a dataframe and write to a table

```{r analysis, include=FALSE}

frags <- read.delim(file="fragments_with_mut_ids.txt", header = TRUE)
colnames(frags) <- c("iterations", "fragment")

# create empty data frame to store information about
# mutation carrying fragments from all iterations
selected = data.frame(fragment=character(),
  length=numeric(),
  numhm=numeric(),
  numht=numeric(),
  varpercent=numeric(),
  hmpercent=numeric(),
  file=character(),
  stringsAsFactors=FALSE)

## read all files in a folder and store to a dataframe
dir = getwd()
dir = paste(dir, "vars_infrags", sep='/')
filelist = list.files(dir, "^genome_")
numfiles = length(filelist)
pb = tkProgressBar(title="Progress bar of iteration data processing", min=0, max=numfiles, width=400)

for (i in 1:numfiles) {
  filename = paste(dir, filelist[i], sep='/')
  newdf <- read.delim(file=filename, header = TRUE, stringsAsFactors=FALSE)
  iteration = gsub("_varinfo.txt$", "", filelist[i])
  fragid = as.character(frags[which(frags$iterations == iteration),]$fragment)
  
  # selected fragments with variants
  withvars = subset(newdf, numhm + numht > 0)
  withvars$ratio = (withvars$numhm + 0.5)/(withvars$numht + 0.5)
  withvars = withvars[order(withvars$ratio, decreasing = TRUE),]
  row.names(withvars) <- NULL
  varpercent = as.numeric(row.names(withvars[withvars$fragment==fragid,])) * 100 /nrow(withvars)
  
  # selected fragments with more hm than ht variants
  high_hm = subset(newdf, numhm > numht)
  high_hm$ratio = (high_hm$numhm + 0.5)/(high_hm$numht + 0.5)
  high_hm = high_hm[order(high_hm$ratio, decreasing = TRUE),]
  row.names(high_hm) <- NULL
  hmpercent = as.numeric(row.names(high_hm[high_hm$fragment==fragid,])) * 100 /nrow(high_hm)
  
  selected[i,] = c(subset(newdf, fragment==fragid), varpercent, hmpercent, iteration)
  setTkProgressBar(pb, i)
}
close(pb)

# save all iteration fragment data to a file
write.table(selected, file="frags_mutation_all_iterations.txt", sep="\t", row.names = FALSE)

```

...

...


#### box plot of length fragments, homozygous, heterozygous variants and ratio

```{r boxplot, echo=FALSE, fig.width=12, fig.height=12}

selected$ratio = (selected$numhm + 0.5)/(selected$numht + 0.5)
selected$adjratio <- selected$ratio/selected$length
par(mfrow=c(2,3), mar=c(4,3,1,1))
boxplot(selected$length, xlab="length\n", cex.lab=2, cex.axis=2)
boxplot(selected$ratio, xlab="ratio\n", cex.lab=2, cex.axis=2)
boxplot(selected$adjratio, xlab="length adj ratio\n", cex.lab=2, cex.axis=2)
boxplot(selected$numhm, xlab="hm vars in frag\n", cex.lab=2, cex.axis=2)
boxplot(selected$varpercent, xlab="frag rank as %\nof frags with vars", cex.lab=2, cex.axis=2)
boxplot(selected$hmpercent, xlab="frag rank as %\nof frags with >hm", cex.lab=2, cex.axis=2)

```


...


#### ratios of fragments with causative mutation

```{r plotvars, echo=FALSE, fig.width=12, fig.height=4}
par(mfrow=c(1,3), mar=c(4,3,3,1))

plot(sort(selected$varpercent), as.numeric(row.names(selected))*100/nrow(selected), xlab="frag rank as %\nof frags with vars", cex.lab=2, cex.axis=2, axes=FALSE)
axis(3)
axis(2)
plot(sort(selected$hmpercent), as.numeric(row.names(selected))*100/nrow(selected), xlab="frag rank as %\nof frags with >hm", cex.lab=2, cex.axis=2, axes=FALSE)
axis(3)
axis(2)
plot(sort(selected$ratio), as.numeric(row.names(selected))*100/nrow(selected), xlab="ratio of frag\nwith mutation", cex.lab=2, cex.axis=2, axes=FALSE)
axis(3)
axis(2)

```

...


#### summary about ratio of fragment with causative mutation from all iterations
```{r sub-report1, echo=FALSE}

summary(selected$ratio)
```

...


#### summary about rank of fragment with causative mutation as percentage of all fragments with variants from all iterations
```{r sub-report2, echo=FALSE}

summary(selected$varpercent)
```

...


#### summary about rank of fragment with causative mutation as percentage of all fragments with more hm variants from all iterations
```{r sub-report3, echo=FALSE}

summary(selected$hmpercent)
```

...

...

---
output:
  html_document:
    fig_caption: yes
    theme: spacelab
    toc: no
---
# **plots of variant distribution along chromosome length**
Load libraries and the data
```{r setup, include=FALSE, message=FALSE}
# load the required libraries and functions
library(knitr)
library(markdown)
#opts_chunk$set(dev = 'pdf')
library(quantchem)
library(reshape2)

# source custom R functions
source('~/git-hub-repos/shyamrallapalli/mutations_hts_noref/lib/ggplot_theme.R')
source('~/git-hub-repos/shyamrallapalli/mutations_hts_noref/lib/zero_ratio_adj.R')
source('~/git-hub-repos/shyamrallapalli/mutations_hts_noref/lib/lm_eqn_plot.R')

```

...     


...  		

#### 10Mb - 500kb bins
```{r 10Mb-500kb, echo=FALSE, fig.width=12, fig.height=6}
hsty <- read.delim(file="10000000-per500000bp-filtered_hsty_mutant.vcf.txt", header = TRUE)
soc1 <- read.delim(file="10000000-per500000bp-filtered_96_1_fd2_mutant.vcf.txt", header = TRUE)
sup1 <- read.delim(file="10000000-per500000bp-filtered_sup1_colT_wsT.vcf.txt", header = TRUE)
sup2 <- read.delim(file="10000000-per500000bp-filtered_sup2_colT_wsT.vcf.txt", header = TRUE)
hsty <- re_zero_ratio(hsty, 0.01)
soc1 <- re_zero_ratio(soc1, 0.01)
sup1 <- re_zero_ratio(sup1, 0.01)
sup2 <- re_zero_ratio(sup2, 0.01)
ggplot() + stat_smooth(data=hsty, aes(x=position, y=ratio/sum(ratio), colour="hsty"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=soc1, aes(x=position, y=ratio/sum(ratio), colour="soc1"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=sup1, aes(x=position, y=ratio/sum(ratio), colour="sup1"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=sup2, aes(x=position, y=ratio/sum(ratio), colour="sup2"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  scale_y_sqrt() + labs(y=NULL, main="genome in 500 KB fragment chunks") + mytheme


```


...		


...  		

#### 25Mb - 500kb bins
```{r 25Mb-500kb, echo=FALSE, fig.width=12, fig.height=6}
hsty <- read.delim(file="25000000-per500000bp-filtered_hsty_mutant.vcf.txt", header = TRUE)
soc1 <- read.delim(file="25000000-per500000bp-filtered_96_1_fd2_mutant.vcf.txt", header = TRUE)
sup1 <- read.delim(file="25000000-per500000bp-filtered_sup1_colT_wsT.vcf.txt", header = TRUE)
sup2 <- read.delim(file="25000000-per500000bp-filtered_sup2_colT_wsT.vcf.txt", header = TRUE)
hsty <- re_zero_ratio(hsty, 0.01)
soc1 <- re_zero_ratio(soc1, 0.01)
sup1 <- re_zero_ratio(sup1, 0.01)
sup2 <- re_zero_ratio(sup2, 0.01)
ggplot() + stat_smooth(data=hsty, aes(x=position, y=ratio/sum(ratio), colour="hsty"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=soc1, aes(x=position, y=ratio/sum(ratio), colour="soc1"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=sup1, aes(x=position, y=ratio/sum(ratio), colour="sup1"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=sup2, aes(x=position, y=ratio/sum(ratio), colour="sup2"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  scale_y_sqrt() + labs(y=NULL, main="genome in 500 KB fragment chunks") + mytheme


```



#### 25Mb - 500kb bins (adjusted soc1 and hsty)
```{r 25Mb-adjusted, echo=FALSE, fig.width=12, fig.height=6}
soc1$position <- soc1$position + 3000000
hsty$position <- hsty$position - 1000000
ggplot() + stat_smooth(data=hsty, aes(x=position, y=ratio/sum(ratio), colour="hsty"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=soc1, aes(x=position, y=ratio/sum(ratio), colour="soc1"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=sup1, aes(x=position, y=ratio/sum(ratio), colour="sup1"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  stat_smooth(data=sup2, aes(x=position, y=ratio/sum(ratio), colour="sup2"), method="lm", se=FALSE, formula=y ~ poly(x, 4, raw=TRUE)) +
  scale_y_sqrt() + labs(y=NULL, main="genome in 500 KB fragment chunks") + mytheme
```



#### polyfit coefficients
```{r 25Mb-equations, echo=FALSE, fig.width=12, fig.height=6}
cat ("## sup1")
summary(lm(sup1$ratio/sum(sup1$ratio) ~ poly(sup1$position, 4, raw=TRUE)))
cat ("## sup2")
summary(lm(sup2$ratio/sum(sup2$ratio) ~ poly(sup2$position, 4, raw=TRUE)))
cat ("## soc1")
summary(lm(soc1$ratio/sum(soc1$ratio) ~ poly(soc1$position, 4, raw=TRUE)))
cat ("## hsty")
summary(lm(hsty$ratio/sum(hsty$ratio) ~ poly(hsty$position, 4, raw=TRUE)))

```

...		


...  		

#### curve fit for sup1 data
```{r sup1-10mb_1 curvefit, echo=FALSE, warning=FALSE, fig.width=12, fig.height=10}
sup1_10mb <- read.delim(file="10000000-per500000bp-filtered_sup1_colT_wsT.vcf.txt", header = TRUE)
sup1_10mb <- re_zero_ratio(sup1_10mb, 0.01)
fit = lmcal(sup1_10mb$position, sup1_10mb$ratio)
par(mfrow=c(4,5))
plot(fit, type = "curve", xlab = "position", ylab = "ratio")


```



#### boxplot of residuals of sup1 data fit
```{r sup1-10mb_2 curvefit, echo=FALSE, fig.width=8, fig.height=5}
boxplot(residuals(fit))
```

...		


...  		

#### quantchem curve fit for sup2 data
```{r sup2-10mb_1 curvefit, echo=FALSE, warning=FALSE, fig.width=12, fig.height=10}

sup2_10mb <- read.delim(file="10000000-per500000bp-filtered_sup2_colT_wsT.vcf.txt", header = TRUE)
sup2_10mb <- re_zero_ratio(sup2_10mb, 0.01)
fit = lmcal(sup2_10mb$position, sup2_10mb$ratio)
par(mfrow=c(4,5))
plot(fit, type = "curve", xlab = "position", ylab = "ratio")


```



#### boxplot of residuals of sup2 data fit
```{r sup2-10mb_2 curvefit, echo=FALSE, fig.width=8, fig.height=5}
boxplot(residuals(fit))
```

...		

...  		

#### curve fit for soc1 data
```{r soc1-10mb_1 curvefit, echo=FALSE, warning=FALSE, fig.width=12, fig.height=10}

soc1_10mb <- read.delim(file="10000000-per500000bp-filtered_96_1_fd2_mutant.vcf.txt", header = TRUE)
soc1_10mb <- re_zero_ratio(soc1_10mb, 0.01)
fit = lmcal(soc1_10mb$position, soc1_10mb$ratio)
par(mfrow=c(4,5))
plot(fit, type = "curve", xlab = "position", ylab = "ratio")


```



#### boxplot of residuals of sco1 data fit
```{r soc1-10mb_2 curvefit, echo=FALSE, fig.width=8, fig.height=5}
boxplot(residuals(fit))
```

...		

...  		

#### curve fit for hsty data
```{r hsty-10mb_1 curvefit, echo=FALSE, warning=FALSE, fig.width=12, fig.height=10}
hsty_10mb <- hsty <- read.delim(file="10000000-per500000bp-filtered_hsty_mutant.vcf.txt", header = TRUE)
hsty_10mb <- re_zero_ratio(hsty_10mb, 0.01)
hsty_10mb$ratio <- hsty_10mb$ratio + 0.01
fit = lmcal(hsty_10mb$position, hsty_10mb$ratio)
par(mfrow=c(4,5))
plot(fit, type = "curve", xlab = "position", ylab = "ratio")


```



#### boxplot of residuals of hsty data fit
```{r hsty-10mb_2 curvefit, echo=FALSE, fig.width=8, fig.height=5}
boxplot(residuals(fit))
```


...		

...  		

#### lm poly for sup1 data (10Mb around mutation)
```{r sup1-10mb curvefit, echo=FALSE, fig.width=12, fig.height=6}
sup1_10mb <- read.delim(file="10000000-per500000bp-filtered_sup1_colT_wsT.vcf.txt", header = TRUE)
sup1_10mb <- re_zero_ratio(sup1_10mb, 0.01)

lmfit2 <- lm(sup1_10mb$ratio ~ poly(sup1_10mb$position, 2, raw=TRUE))
lmfit3 <- lm(sup1_10mb$ratio ~ poly(sup1_10mb$position, 3, raw=TRUE))
lmfit4 <- lm(sup1_10mb$ratio ~ poly(sup1_10mb$position, 4, raw=TRUE))
lmfit5 <- lm(sup1_10mb$ratio ~ poly(sup1_10mb$position, 5, raw=TRUE))
lmfit6 <- lm(sup1_10mb$ratio ~ poly(sup1_10mb$position, 6, raw=TRUE))
barplot(sup1_10mb$ratio)
lines(predict(lmfit2, data.frame(x=sup1_10mb$position)), col="red")
lines(predict(lmfit3, data.frame(x=sup1_10mb$position)), col="blue")
lines(predict(lmfit4, data.frame(x=sup1_10mb$position)), col="green")
lines(predict(lmfit5, data.frame(x=sup1_10mb$position)), col="orange")
lines(predict(lmfit6, data.frame(x=sup1_10mb$position)), col="grey")


```


...		


...  		

#### lm poly fit for sup1 data (25Mb around mutation)
```{r sup1-25mb curvefit, echo=FALSE, fig.width=12, fig.height=6}
sup1_25mb <- read.delim(file="25000000-per500000bp-filtered_sup1_colT_wsT.vcf.txt", header = TRUE)
sup1_25mb <- re_zero_ratio(sup1_25mb, 0.01)

lmfit2 <- lm(sup1_25mb$ratio ~ poly(sup1_25mb$position, 2, raw=TRUE))
lmfit3 <- lm(sup1_25mb$ratio ~ poly(sup1_25mb$position, 3, raw=TRUE))
lmfit4 <- lm(sup1_25mb$ratio ~ poly(sup1_25mb$position, 4, raw=TRUE))
lmfit5 <- lm(sup1_25mb$ratio ~ poly(sup1_25mb$position, 5, raw=TRUE))
lmfit6 <- lm(sup1_25mb$ratio ~ poly(sup1_25mb$position, 6, raw=TRUE))
barplot(sup1_25mb$ratio)
lines(predict(lmfit2, data.frame(x=sup1_25mb$position)), col="red")
lines(predict(lmfit3, data.frame(x=sup1_25mb$position)), col="blue")
lines(predict(lmfit4, data.frame(x=sup1_25mb$position)), col="green")
lines(predict(lmfit5, data.frame(x=sup1_25mb$position)), col="orange")
lines(predict(lmfit6, data.frame(x=sup1_25mb$position)), col="grey")


```


...		


